/*
rush build --production
rush test --production

// Skips incremental build
rush --full build --production

// Deletes all build outputs
rush clean
*/

{
  "commands": [
    {
      "commandKind": "bulk", // Bulk commands can eventually be deprecated for multiphase commands with a single upstream phase dependency
      "name": "my-bulk-command",
      "summary": "Example bulk custom command",
      "description": "This is an example custom command that runs separately for each project",

      "safeForSimultaneousRushProcesses": false,
      "enableParallelism": false,
      "ignoreDependencyOrder": false,
      "ignoreMissingScript": false,
      "allowWarningsInSuccessfulBuild": false
    },

    {
      "commandKind": "phased",
      "name": "build",
      "safeForSimultaneousRushProcesses": false,

      // Order not important, as this will be determined by the phase configuration.
      // All required phases should be specified for clarity, throw error if not true
      "phases": [ "_phase:compile", "_phase:docs" ]

      /*
      "parameters": {
        "--no-docs": {
          "phases": [ "_phase:compile" ]
        }
      }
      */

      // Other properties have been moved into the individual phases
    },


    {
      "commandKind": "phased",
      "name": "test",
      "safeForSimultaneousRushProcesses": false,

      // Order not important, as this will be determined by the phase configuration.
      // All required phases should be specified for clarity, throw error if not true
      "phases": [ "_phase:compile", "_phase:test", "_phase:docs" ]

      // Other properties have been moved into the individual phases
    }
  ],

  "phases": [

    {
      "name": "_phase:compile",
      "summary": "Build phase",
      "description": "",
      "dependencies": {
        // We can start build of this project after build of upstream project completes (no need for tests)
        "upstream": [ "_phase:compile" ]
      },
      "ignoreMissingScript": true,
      "allowWarningsOnSuccess": false,
      "enableParallelism": true
    },

    {
      "name": "_phase:test",
      "summary": "Test phase",
      "description": "",
      "dependencies": {
        "self": [ "_phase:compile" ]
      },
      "ignoreMissingScript": true,
      "allowWarningsOnSuccess": false,
      "enableParallelism": true
    },

    {
      "name": "_phase:docs",
      "summary": "Docs phase",
      "description": "",
      "dependencies": {
        "self": [ "_phase:compile" ],
        // Need upstream docs to generate project docs
        "upstream": [ "_phase:docs" ]
      },
      "ignoreMissingScript": true,
      "allowWarningsOnSuccess": false,
      "enableParallelism": true
    }

  ],
  "parameters": [
    {
      "parameterKind": "flag",
      "longName": "--production",
      "shortName": "-p",
      "description": "A custom flag parameter that is passed to the scripts that are invoked when building projects",
      "associatedCommands": [ "build" ],
       // Only the phases in the command that this parameter applies to
      "associatedPhases": [ "_phase:compile", "_phase:docs" ]
    }
  ]
}